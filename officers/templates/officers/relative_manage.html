{% load static %}
{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ officer.birth_name }} - Thân nhân</title>
        {% tailwind_css %}

        <script>
            function confirmDelete() {
                return confirm('Are you sure you want to delete this title?');
            }
        </script>
    </head>
    <body>
        <div class="navbar bg-base-100">
            <div class="navbar-start">
                <div class="dropdown">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle ml-10 mt-5">
                        <img src="{% static 'src/menu.png' %}" alt="Menu" class="w-10 h-10">
                    </div>
                    <ul
                        tabindex="0"
                        class="menu menu-lg dropdown-content bg-base-200 rounded-box z-[1] mt-3 w-52 p-2 ml-5 shadow">
                        <li><a href="{% url 'url_title_view' officer.pk %}">Chức danh</a></li>
                        <li><a href="{% url 'url_position_plan' officer.pk %}">Quy hoạch</a></li>
                        <li><a href="{% url 'url_learning_path' officer.pk %}">Đào tạo</a></li> 
                        <li><a href="{% url 'url_work_process' officer.pk %}">Quá trình công tác</a></li> 
                        <li><a href="{% url 'url_salary_process' officer.pk %}">Quá trình lương</a></li>
                        <li><a href="{% url 'url_laudatory' officer.pk %}">Khen thưởng</a></li>
                        <li><a href="{% url 'url_discipline' officer.pk %}">Kỷ luật</a></li> 
                        <li><a href="{% url 'url_relative' officer.pk %}">Thân nhân</a></li> 
                        <li><a href="{% url 'url_abroad' officer.pk %}">Ra nước ngoài</a></li>
                        <li><a href="{% url 'url_army_join_history' officer.pk %}">Tham gia quân đội</a></li>
                        <li><a href="{% url 'url_health' officer.pk %}">Sức khoẻ</a> 
                        
                        <a href="{% url 'officer_update' officer.pk %}">Cập nhật</a> 
                        <a href="{% url 'officer_list' %}">Quay lại danh sách</a>
                    </ul>
                </div>
            </div>
        </div>
        <div>
            <h1 class="text-4xl text-center ">Thân nhân: <strong class="ml-3">{{ officer.birth_name }}</strong></h1>
            <div class="my-10 mx-10">
                <div class="flex justify-between mb-7">
                    <a href="{% url 'officer_detail' officer.pk %}"
                    class="btn shadow-inner drop-shadow-lg text-lg"
                    >
                        <img src="{% static 'src/back-icon.png' %}" alt="Back Icon" class="w-7 h-7">
                        <span>Quay lại</span>
                    </a>
                    <!-- Create New Relative Button -->
                    <a href="{% url 'url_relative_create' officer.pk %}">
                        <button class="btn px-4 py-2 rounded-lg shadow-inner drop-shadow-lg inline-flex items-center text-lg">
                            <span class="mr-2">Thêm mới</span>
                            <!-- Add the folder icon here -->
                            <img src="{% static 'src/new-folder.png' %}" alt="New Folder" class="w-5 h-5">
                        </button>
                    </a>
                </div>

                <table class="table-auto border-collapse w-full text-center">
                    <thead>
                        <tr class="bg-gray-600 text-white text-xl">
                            <th class="py-2 px-4">Quan hệ</th>
                            <th class="py-2 px-4">Họ và tên</th>
                            <th class="py-2 px-4">Năm sinh</th>
                            <th class="py-2 px-4">Nghề nghiệp</th>
                            <th class="py-2 px-4">Chỗ ở hiện nay</th>
                            <th class="py-2 px-4"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for relative in relatives %}
                        <tr class="border-t border-gray-300 bg-gray-100 text-lg">
                            <td class="py-2 px-4">{{ relative.relationship }}</td>
                            <td class="py-2 px-4">{{ relative.name }}</td>
                            <td class="py-2 px-4">{{ relative.birth_year }}</td>
                            <td class="py-2 px-4">{{ relative.job }}</td>
                            <td class="py-2 px-4">{{ relative.current_residence }}</td>
                            <td class="py-2 px-4">
                            
                                <!-- Update Button -->
                                <a href="{% url 'url_relative_update' officer.pk relative.id %}"
                                class="text-green-500 hover:text-green-600 underline mx-2"
                                >
                                    Cập nhật
                                </a>

                                <span>/</span>

                                <!-- Delete Button with confirmation -->
                                <form
                                    method="POST"
                                    action="{% url 'url_relative_delete' officer.pk relative.id %}"
                                    style="display: inline"
                                    onsubmit="return confirmDelete();"
                                >
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-700 underline mx-2">Xoá</button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Create or Update Relative Form -->
            {% if form %}
            <dialog class="modal" id="modal">
                <div class="modal-box">
                    <h1 class="text-xl font-semibold mb-7 ml-2">
                        {% if edit_relative_id %}Cập nhật thông tin:{% else %}Thêm mới thông tin:
                        {% endif %}
                    </h1>
                    <form method="dialog">
                        <a href="{% url 'url_relative' officer.pk %}" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 mr-2 mt-4">
                            <img src="{% static 'src/close.png' %}" alt="Close Form" class="w-5 h-5">
                        </a>
                    </form>

                    <form method="POST" class="ml-10">
                        {% csrf_token %} 
                        
                        <div class="pb-5">
                            <label for="relationship" class="font-semibold mr-16">Quan hệ:</label>
                            {{ form.relationship }}
                        </div>
                        <div class="pb-5">
                            <label for="name" class="font-semibold mr-14">Họ và tên:</label>
                            {{ form.name }}
                        </div>
                        <div class="pb-5">
                            <label for="birth_year" class="font-semibold mr-14">Năm sinh:</label>
                            {{ form.birth_year }}
                        </div>
                        <div class="pb-5">
                            <label for="job" class="font-semibold mr-8">Nghề nghiệp:</label>
                            {{ form.job }}
                        </div>
                        <div>
                            <label for="current_residence" class="font-semibold mr-4">Chỗ ở hiện nay:</label>
                            {{ form.current_residence }}
                        </div>
                        
                        <div class="modal-action">
                            <button type="submit" class="btn mr-1">
                                Lưu
                            </button>
                        </div>
                    </form>
                </div>
                <form method="dialog" class="modal-backdrop">
                    <a href="{% url 'url_relative' officer.pk %}">close</a>
                </form>
            </dialog>
            {% endif %}

            <script>
                // Automatically show the modal when the page loads
                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById('modal').showModal();
                });
            </script>
        </div>
    </body>
</html>
