{% load static %}
{% load static tailwind_tags %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{{ officer.birth_name }} - Chức danh</title>
        {% tailwind_css %}

        <link rel="stylesheet" href="{% static 'src/styles.css' %}">

        <script>
            function confirmDelete() {
                return confirm('Are you sure you want to delete this title?');
            }
        </script>
    </head>
    <body>
        <div class="drawer">
            <input id="my-drawer" type="checkbox" class="drawer-toggle" />
            <div class="drawer-content">
                <!-- Page content here -->
                <label for="my-drawer" class="btn btn-ghost btn-circle ml-10 mt-5">
                    <img src="{% static 'src/menu.png' %}" alt="Menu" class="w-10 h-10">
                </label>

                <h1 class="text-4xl text-center">Thông tin chức danh: <strong class="ml-3">{{ officer.birth_name }}</strong></h1>

                <div class="flex justify-between mb-7 mt-10 mx-10">
                    <a href="{% url 'officer_detail' officer.pk %}"
                    class="btn shadow-inner drop-shadow-lg text-lg rounded-lg"
                    >
                        <img src="{% static 'src/back-icon.png' %}" alt="Back Icon" class="w-7 h-7">
                        <span>Quay lại</span>
                    </a>
                    
                    <!-- Create New Position Plan Button -->
                    <a href="{% url 'url_position_plan_create' officer.pk %}">
                        <button class="btn px-4 py-2 rounded-lg shadow-inner drop-shadow-lg inline-flex items-center text-lg z-10">
                            <span class="mr-2">Thêm mới</span>
                            <img src="{% static 'src/new-folder.png' %}" alt="New Folder" class="w-5 h-5">
                        </button>
                    </a>
                </div>
            </div>
            <div class="drawer-side">
                <label for="my-drawer" aria-label="close sidebar" class="drawer-overlay"></label>
                <ul class="menu bg-base-200 text-base-content min-h-full w-80 p-4 text-lg">
                    <!-- Sidebar content here -->
                    <li><a href="{% url 'url_title_view' officer.pk %}">Chức danh</a></li>
                    <li><a href="{% url 'url_position_plan' officer.pk %}">Quy hoạch</a></li>
                    <li><a href="{% url 'url_learning_path' officer.pk %}">Đào tạo</a></li> 
                    <li><a href="{% url 'url_work_process' officer.pk %}">Quá trình công tác</a></li> 
                    <li><a href="{% url 'url_salary_process' officer.pk %}">Quá trình lương</a></li>
                    <li><a href="{% url 'url_laudatory' officer.pk %}">Khen thưởng</a></li>
                    <li><a href="{% url 'url_discipline' officer.pk %}">Kỷ luật</a></li> 
                    <li><a href="{% url 'url_relative' officer.pk %}">Thân nhân</a></li> 
                    <li><a href="{% url 'url_abroad' officer.pk %}">Ra nước ngoài</a></li>
                    <li><a href="{% url 'url_army_join_history' officer.pk %}">Tham gia quân đội</a></li>
                    <li><a href="{% url 'url_health' officer.pk %}">Sức khoẻ</a> 
                    
                    <a href="{% url 'officer_update' officer.pk %}">Cập nhật</a> 
                    <a href="{% url 'officer_list' %}">Quay lại danh sách</a>
                </ul>
            </div>
        </div>

        <div>
            <div class="mx-10">
                <table class="table-auto border-collapse w-full text-center">
                    <thead>
                        <tr class="bg-gray-600 text-white text-xl">
                            <th class="py-2 px-4">Ngày bổ nhiệm</th>
                            <th class="py-2 px-4">Chức danh</th>
                            <th class="py-2 px-4"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for title in titles %}
                        <tr class="border-t border-gray-300 bg-gray-100 text-lg">
                            <td class="py-2 px-4">{{ title.appointed_date|date:"d/m/Y" }}</td>
                            <td class="py-2 px-4">{{ title.title }}</td>
                            <td class="py-2 px-4">
                                <!-- Update Button -->
                                <a href="{% url 'url_title_update' officer.pk title.id %}"  
                                class="text-green-500 hover:text-green-600 underline mx-2"
                                >
                                    Cập nhật
                                </a>

                                <span>/</span>

                                <!-- Delete Button with confirmation -->
                                <form
                                    method="POST"
                                    action="{% url 'url_title_delete' officer.pk title.id %}"
                                    style="display: inline"
                                    onsubmit="return confirmDelete();"
                                >
                                    {% csrf_token %}
                                    <button type="submit" class="text-red-600 hover:text-red-700 underline mx-2">
                                        Xoá
                                    </button>
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Form for creating/updating titles -->
            {% if form %}
            <dialog id="modal" class="modal">
                <div class="modal-box">
                    <h1 class="text-xl text-center font-semibold mb-7 ml-2">
                        {% if edit_title_id %}Cập nhật thông tin{% else %}Thêm mới thông tin{% endif %}
                    </h1>
                    <form method="dialog">
                        <a href="{% url 'url_title_view' officer.pk %}" class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2 mr-5 mt-4">
                            <img src="{% static 'src/close.png' %}" alt="Close Form" class="w-5 h-5">
                        </a>
                    </form>
                    
                    <form method="POST">
                        {% csrf_token %}
                        
                        <label for="id_appointed_date" class="font-semibold ml-8">Ngày bổ nhiệm:</label>
                        <div class="form-group mt-3 mx-5">
                            {{ form.appointed_date }}
                        </div>
                        
                        <label for="id_title" class="font-semibold ml-8">Chức danh:</label>
                        <div class="form-group mt-3 mx-5">
                            {{ form.title }}
                        </div>
                        <div class="modal-action">
                            <button type="submit" class="btn mr-3 rounded-lg">
                                Lưu
                            </button>
                        </div>
                    </form>  
                </div>
                <form method="dialog" class="modal-backdrop">
                    <a href="{% url 'url_title_view' officer.pk %}">close</a>
                </form>
            </dialog>
            {% endif %}

            <script>
                // Automatically show the modal when the page loads
                document.addEventListener("DOMContentLoaded", function() {
                    document.getElementById('modal').showModal();
                });
            </script>
            
        </div>
    </body>
</html>
